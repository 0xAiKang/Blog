---
title: Linux系统监控命令整理汇总
date: 2020-11-17 22:55:16
tags: ["Linux"]
categories: ["Linux"]
---

以下命令以Ubuntu 18.4 LTS 系统为准。

<!-- more -->

|命令|功能|实例|
|-|-|-|
|free|查看内存使用情况，包括物理内存和虚拟内存|free -h 或 free -m|
|vmstat|对系统的整体情况进行统计，包括内核进程、虚拟内存、磁盘、陷阱和 CPU 活动的统计信息|vmstat 2 100|
|top|实时显示系统中各个进程的资源占用状况及总体状况|top|
|mpstat|实时系统监控工具，它会报告与CPU相关的统计信息|	mpstat|
|sar|收集、报告和保存CPU、内存、输入输出端口使用情况|sar -n DEV 3 100|
|netstat|检验本机各端口的网络连接情况，用于显示与IP、TCP、UDP和ICMP协议相关的统计数据|netstat -a|
|tcpdump|用于捕捉或者过滤网络上指定接口上接收或者传输的TCP/IP包|tcpdump -i eth0 -c 3|
|iptraf|用来生成包括TCP信息、UDP计数、ICMP和OSPF信息、以太网负载信息、节点状态信息、IP校验和错误等等统计数据|iptraf|
|iostat|收集显示系统存储设备输入和输出状态统计|iostat -x -k 2 100|
|lsof|查看进程打开的文件的工具，查看监听端口|lsof -i :3000|
|atop|显示的是各种系统资源（CPU, memory, network, I/O, kernel）的综合，并且在高负载的情况下进行了彩色标注|atop|
|htop|它和top命令十分相似，高级的交互式的实时linux进程监控工具|htop|
|ps|最基本同时也是非常强大的进程查看命令|ps aux | grep php |
|glances|监视 CPU，平均负载，内存，网络流量，磁盘 I/O，其他处理器 和 文件系统 空间的利用情况|glances|
|dstat|全能系统信息统计工具，可用于替换vmstat、iostat、netstat、nfsstat和ifstat这些命令的工具|dstat|
|uptime|用于查看服务器运行了多长时间以及有多少个用户登录，快速获知服务器的负荷情况|uptime|
|dmesg|主要用来显示内核信息。使用dmesg可以有效诊断机器硬件故障或者添加硬件出现的问题 |dmesg|
|mpstat|用于报告多路CPU主机的每颗CPU活动情况，以及整个主机的CPU情况 |mpstat 2 3|
|nmon|监控CPU、内存、I/O、文件系统及网络资源。对于内存的使用，它可以实时的显示 总/剩余内存、交换空间等信息 |nmon|
|mytop|用于监控 mysql 的线程和性能。它能让你实时查看数据库以及正在处理哪些查询 |mytop|
|iftop|用来监控网卡的实时流量（可以指定网段）、反向解析IP、显示端口信息等|iftop|
|jnettop|以相同的方式来监测网络流量但比 iftop 更形象。它还支持自定义的文本输出，并能以友好的交互方式来深度分析日志|jnettop|
|ngrep|网络层的 grep。它使用 pcap ，允许通过指定扩展正则表达式或十六进制表达式来匹配数据包|ngrep|
|nmap|可以扫描你服务器开放的端口并且可以检测正在使用哪个操作系统|nmap localhost|
|du|查看Linux系统中某目录的大小|du -sh *|
|fdisk|查看硬盘及分区信息|fdisk -l|

## 内存监控
### free
`free`命令可以显示当前系统未使用的和已使用的内存数目，还可以显示被内核使用的内存缓冲区。

语法
```
free (选项)
```

常用选项：
`-b`：以Byte为单位显示内存使用情况；
`-k`：以KB为单位显示内存使用情况；
`-m`：以MB为单位显示内存使用情况；
`-g`：以GB为单位显示内存使用情况;
`-o`：不显示缓冲区调节列；
`-t`：显示内存总和列；
`-V`：显示版本信息。

![](https://cdn.jsdelivr.net/gh/0xAiKang/CDN/blog/images/20201117222535.png)

字段说明：
* total：内存总数；
* used：已经使用的内存数，包括 cached 和应用程序实际使用的内存；
* free：空闲的内存数；
* shared：当前已经废弃不用；
* buffers：缓存内存数；
* cached：缓存内存数。

关系：total = used + free

## vmstat
vmstat命令 的含义为显示虚拟内存状态（“Viryual Memor Statics”），但是它可以报告关于进程、内存、I/O等系统整体运行状态。

语法
```
vmstat (选项) (参数)
```

选项
`-a`：显示活动内页；
`-f`：显示启动后创建的进程总数；
`-m`：显示slab信息；
`-n`：头信息仅显示一次；
`-s`：以表格方式显示事件计数器和内存状态；
`-d`：报告磁盘状态；
`-p`：显示指定的硬盘分区状态；
`-S`：输出信息的单位。

参数
* 事件间隔：状态信息刷新的时间间隔；
* 次数：显示报告的次数。

![](https://cdn.jsdelivr.net/gh/0xAiKang/CDN/blog/images/20201117223922.png)

字段说明：
Procs（进程）
* r: 运行队列中进程数量，这个值也可以判断是否需要增加CPU。（长期大于1）
* b: 等待IO的进程数量。

Memory（内存）
* swpd: 使用虚拟内存大小，如果swpd的值不为0，但是SI，SO的值长期为0，这种情况不会影响系统性能。
* free: 空闲物理内存大小。
* buff: 用作缓冲的内存大小。
* cache: 用作缓存的内存大小，如果cache的值大的时候，说明cache处的文件数多，如果频繁访问到的文件都能被cache处，那么磁盘的读IO bi会非常小。

Swap
* si: 每秒从交换区写到内存的大小，由磁盘调入内存。
* so: 每秒写入交换区的内存大小，由内存调入磁盘。

注意：内存够用的时候，这2个值都是0，如果这2个值长期大于0时，系统性能会受到影响，磁盘IO和CPU资源都会被消耗。有些朋友看到空闲内存（free）很少的或接近于0时，就认为内存不够用了，不能光看这一点，还要结合si和so，如果free很少，但是si和so也很少（大多时候是0），那么不用担心，系统性能这时不会受到影响的。

IO（现在的Linux版本块的大小为1kb）
* bi: 每秒读取的块数
* bo: 每秒写入的块数

注意：随机磁盘读写的时候，这2个值越大（如超出1024k)，能看到CPU在IO等待的值也会越大。

system（系统）
* in: 每秒中断数，包括时钟中断。
* cs: 每秒上下文切换数。
注意：上面2个值越大，会看到由内核消耗的CPU时间会越大。

CPU（以百分比表示）
us: 用户进程执行时间百分比(user time)
us的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超50%的使用，那么我们就该考虑优化程序算法或者进行加速。
* sy: 内核系统进程执行时间百分比(system time)
sy的值高时，说明系统内核消耗的CPU资源多，这并不是良性表现，我们应该检查原因。
* wa: IO等待时间百分比

wa的值高时，说明IO等待比较严重，这可能由于磁盘大量作随机访问造成，也有可能磁盘出现瓶颈（块操作）。
id: 空闲时间百分比

### 参考链接
* [Linux系统监控命令整理汇总-掌握CPU,内存,磁盘IO等找出性能瓶颈](https://wzfou.com/linux-jiankong/)