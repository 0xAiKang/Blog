---
title: Go è¯­è¨€å­¦ä¹ ç¬”è®°â€”â€”æ¥å£è¿è¡Œæ—¶è¡¨ç¤º
date: 2022-11-03 22:55:28
tags: ["Go"]
categories: ["Go"]
---

æ¥å£åœ¨ Go ä¸­çš„åœ°ä½éå¸¸é«˜ï¼Œè¿™æ˜¯å› ä¸ºæ¥å£æ˜¯ Go è¿™é—¨é™æ€è¯­è¨€ä¸­å”¯ä¸€â€œåŠ¨é™å…¼å®¹â€çš„è¯­æ³•ç‰¹æ€§ã€‚

<!-- more -->

## é™æ€ç‰¹æ€§ä¸åŠ¨æ€ç‰¹æ€§

æ¥å£çš„é™æ€ç‰¹æ€§ä½“ç°åœ¨**æ¥å£ç±»å‹å˜é‡å…·æœ‰é™æ€ç±»å‹**ã€‚\

æ‹¥æœ‰é™æ€ç±»å‹æ„å‘³ç€**ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå¯¹æ‰€æœ‰æ¥å£ç±»å‹å˜é‡çš„èµ‹å€¼æ“ä½œè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥å³å€¼çš„ç±»å‹æ˜¯å¦å®ç°äº†è¯¥æ¥å£æ–¹æ³•é›†åˆçš„æ‰€æœ‰æ–¹æ³•**ï¼Œå¦‚æœæ²¡æœ‰å®ç°ï¼Œåˆ™ä¼šç¼–è¯‘å¤±è´¥ã€‚è€Œä¸æ˜¯ç­‰åˆ°è¿è¡Œæ—¶æ‰ä¼šæ£€æŸ¥ã€‚

```go
var err error = 1 // cannot use 1 (type int) as type error in assignment: int does not implement error (missing Error method)
```

æ¥å£çš„åŠ¨æ€ä½“ç°åœ¨æ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶è¿˜**å­˜å‚¨äº†å³å€¼çš„çœŸå®ç±»å‹ä¿¡æ¯ï¼Œè¿™ä¸ªå³å€¼çš„çœŸå®ç±»å‹ä¿¡æ¯è¢«ç§°ä¸ºæ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹**ã€‚

```go
var err error
err = error.New("error1")
fmt.Printf("%T \n", err)   // *errors.errorString
```

ä»ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œerr æ¥å£ç±»å‹å˜é‡æ˜¯ `errors.New` æ„é€ çš„ä¸€ä¸ªé”™è¯¯å€¼ï¼Œå€ŸåŠ© `fmt.Printf` å‡½æ•°è¾“å‡ºäº†æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹æ˜¯ `*errors.errorString`ã€‚

## åŠ¨é™å…¼å®¹çš„ç‰¹æ€§æœ‰ä»€ä¹ˆå¥½å¤„
æ¥å£ç±»å‹å˜é‡åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¯ä»¥è¢«èµ‹å€¼ä¸ºä¸åŒçš„åŠ¨æ€ç±»å‹å˜é‡ï¼Œæ¯æ¬¡èµ‹å€¼åï¼Œæ¥å£ç±»å‹å˜é‡ä¸­å­˜å‚¨çš„åŠ¨æ€ç±»å‹ä¿¡æ¯éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™è®© Go è¯­è¨€å¯ä»¥åƒåŠ¨æ€è¯­è¨€ï¼ˆPythonï¼‰é‚£æ ·æ‹¥æœ‰é¸­å­ç±»å‹ï¼ˆDuck Typingï¼‰çš„çµæ´»æ€§ã€‚

> ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹ï¼Ÿ
> 
å°±æ˜¯æŒ‡æŸç±»å‹æ‰€è¡¨ç°å‡ºçš„ç‰¹æ€§ï¼ˆæ¯”å¦‚æ˜¯å¦å¯ä»¥ä½œä¸ºæŸæ¥å£ç±»å‹çš„å³å€¼ï¼‰ï¼Œä¸æ˜¯ç”±å…¶åŸºå› ï¼ˆæ¯”å¦‚ C++ ä¸­çš„çˆ¶ç±»ï¼‰å†³å®šçš„ï¼Œè€Œæ˜¯ç”±ç±»å‹æ‰€è¡¨ç°å‡ºæ¥çš„è¡Œä¸ºï¼ˆæ¯”å¦‚ç±»å‹æ‹¥æœ‰çš„æ–¹æ³•ï¼‰å†³å®šçš„ã€‚

æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š
```go
type QuackableAnimal interface {
    Quack()
}
type Duck struct{}
func (Duck) Quack() {
    println("duck quack!")
}
type Dog struct{}
func (Dog) Quack() {
    println("dog quack!")
}
type Bird struct{}
func (Bird) Quack() {
    println("bird quack!")
}                         
                          
func AnimalQuackInForest(a QuackableAnimal) {
    a.Quack()             
}                         
                          
func main() {             
    animals := []QuackableAnimal{new(Duck), new(Dog), new(Bird)}
    for _, animal := range animals {
        AnimalQuackInForest(animal)
    }  
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨æ¥å£ç±»å‹ `QuackableAnimal` æ¥ä»£è¡¨å…·æœ‰â€œä¼šå«â€ï¼ˆ`Quack()`æ–¹æ³•ï¼‰è¿™ä¸€ç‰¹å¾çš„åŠ¨ç‰©ï¼Œè€Œ Duckã€Bird å’Œ Dog ç±»å‹å„è‡ªéƒ½å…·æœ‰è¿™æ ·çš„ç‰¹å¾ï¼Œ


è¿™é‡Œçš„ Duckã€Birdã€Dod éƒ½æ˜¯â€œé¸­å­ç±»å‹â€ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆè”ç³»ï¼Œä¹‹æ‰€ä»¥èƒ½ä½œä¸ºå³å€¼èµ‹å€¼ç»™ QuackableAnimal ç±»å‹å˜é‡ï¼Œåªæ˜¯å› ä¸ºä»–ä»¬è¡¨ç°å‡ºäº† QuackableAnimal æ‰€è¦æ±‚çš„ç‰¹å¾ç½¢äº†ï¼Œä¹Ÿå°±æ˜¯æ‹¥æœ‰ `Quack()` æ–¹æ³•ï¼Œè€Œä¸éœ€è¦ä¸¥æ ¼çš„ç»§æ‰¿ä½“ç³»ã€‚

ä¸åŠ¨æ€è¯­è¨€ä¸åŒçš„æ˜¯ï¼ŒGo æ¥å£è¿˜å¯ä»¥ä¿è¯â€œåŠ¨æ€ç‰¹æ€§â€ä½¿ç”¨æ—¶çš„å®‰å…¨æ€§ã€‚æ¯”å¦‚ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥æ•æ‰åˆ°å°† int ç±»å‹å˜é‡ä¼ ç»™ QuackableAnimal æ¥å£ç±»å‹å˜é‡è¿™æ ·çš„æ˜æ˜¾é”™è¯¯ï¼Œå†³ä¸ä¼šè®©è¿™æ ·çš„é”™è¯¯é—æ¼åˆ°è¿è¡Œæ—¶æ‰è¢«å‘ç°ã€‚

## ä¸€ä¸ªé—®é¢˜

æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªé—®é¢˜æ¥æ›´æ·±å…¥è®¤è¯†ä¸€ä¸‹åŠ¨é™ç‰¹æ€§ã€‚

```go
type MyError struct {
    error
}
var ErrBad = MyError{
    error: errors.New("bad things happened"),
}
func bad() bool {
    return false
}
func returnsError() error {
    var p *MyError = nil
    if bad() {
        p = &ErrBad
    }
    return p
}
func main() {
    err := returnsError()
    if err != nil {
        fmt.Printf("error occur: %+v\n", err)
        return
    }
    fmt.Println("ok")
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç¨‹åºçš„è¿è¡Œé€»è¾‘å¾ˆæ¸…æ™°ï¼Œè°ƒç”¨ returnsError å‡½æ•°è¿”å›æŒ‡é’ˆå˜é‡ pï¼Œå€¼ä¸º nilï¼Œç„¶åæ¯”è¾ƒ err å˜é‡æ˜¯å¦ç­‰äº nilï¼Œæœ€åè¾“å‡ºç»“æœã€‚

è¿è¡Œä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼Œçœ‹çœ‹ç»“æœæ˜¯å¦å’Œé¢„æœŸä¸€è‡´ï¼š
```go
error occur: <nil>
```

å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰è¾“å‡ºé¢„æœŸçš„ okï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿè¦ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥äº†è§£æ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºã€‚

### æ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤º
æ¥å£ç±»å‹â€œåŠ¨é™å…¼å¤‡â€çš„ç‰¹æ€§ä¹Ÿå†³å®šäº†å®ƒçš„å˜é‡çš„å†…éƒ¨è¡¨ç¤ºç»ä¸åƒä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼ˆå¦‚ intã€float64ï¼‰é‚£æ ·ç®€å•ã€‚

åœ¨Go çš„æºç ä¸­å¯ä»¥æ‰¾åˆ°æ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºï¼š
```go
// $GOROOT/src/runtime/runtime2.go
type iface struct {
    tab  *itab
    data unsafe.Pointer
}
type eface struct {
    _type *_type
    data  unsafe.Pointer
}
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿è¡Œæ—¶å±‚é¢ï¼Œæ¥å£ç±»å‹å˜é‡æœ‰ä¸¤ç§å†…éƒ¨è¡¨ç¤ºï¼š`iface` å’Œ `eface`ï¼Œè¿™ä¸¤ç§è¡¨ç¤ºåˆ†åˆ«ç”¨äºä¸åŒçš„æ¥å£ç±»å‹å˜é‡ï¼š

* eface ç”¨äºè¡¨ç¤ºæ²¡æœ‰æ–¹æ³•çš„ç©ºæ¥å£ï¼ˆempty interfaceï¼‰ç±»å‹å˜é‡ï¼Œä¹Ÿå°±æ˜¯ `interface{}`ç±»å‹çš„å˜é‡
* iface ç”¨äºè¡¨ç¤ºå…¶ä½™æ‹¥æœ‰æ–¹æ³•çš„æ¥å£ interface ç±»å‹å˜é‡

å®ƒä»¬çš„å…±åŒç‚¹æ˜¯éƒ½æ‹¥æœ‰ä¸¤ä¸ªæŒ‡é’ˆå­—æ®µï¼Œå¹¶ä¸”åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡å‘**å½“å‰èµ‹å€¼ç»™è¯¥æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹å˜é‡çš„å€¼**ã€‚

ä¸åŒç‚¹åœ¨äºï¼Œeface è¡¨ç¤ºç©ºæ¥å£ç±»å‹ï¼Œå¹¶æ²¡æœ‰æ–¹æ³•åˆ—è¡¨ï¼Œ
å› æ­¤å®ƒçš„ç¬¬ä¸€ä¸ªæŒ‡é’ˆå­—æ®µæŒ‡å‘ä¸€ä¸ª `_type` ç±»å‹ç»“æ„ï¼Œè¿™ä¸ªæ¥å£ä¸ºè¯¥æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹ä¿¡æ¯ï¼Œå®šä¹‰æ˜¯è¿™æ ·çš„ï¼š
```go
// $GOROOT/src/runtime/type.go
type _type struct {
    size       uintptr
    ptrdata    uintptr // size of memory prefix holding all pointers
    hash       uint32
    tflag      tflag
    align      uint8
    fieldAlign uint8
    kind       uint8
    // function for comparing objects of this type
    // (ptr to object A, ptr to object B) -> ==?
    equal func(unsafe.Pointer, unsafe.Pointer) bool
    // gcdata stores the GC type data for the garbage collector.
    // If the KindGCProg bit is set in kind, gcdata is a GC program.
    // Otherwise it is a ptrmask bitmap. See mbitmap.go for details.
    gcdata    *byte
    str       nameOff
    ptrToThis typeOff
}
```

è€Œ iface é™¤äº†è¦å­˜å‚¨åŠ¨æ€ç±»å‹ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰å­˜å‚¨æ¥å£æœ¬èº«çš„ä¿¡æ¯ï¼ˆæ¥å£çš„ç±»å‹ä¿¡æ¯ã€æ–¹æ³•åˆ—è¡¨ä¿¡æ¯ç­‰ï¼‰ä»¥åŠåŠ¨æ€ç±»å‹æ‰€å®ç°çš„æ–¹æ³•çš„ä¿¡æ¯ï¼Œå› æ­¤ iface çš„ç¬¬ä¸€ä¸ªå­—æ®µæŒ‡å‘ä¸€ä¸ªitabç±»å‹ç»“æ„ã€‚itab ç»“æ„çš„å®šä¹‰å¦‚ä¸‹ï¼š

```go
// $GOROOT/src/runtime/runtime2.go
type itab struct {
    inter *interfacetype
    _type *_type
    hash  uint32 // copy of _type.hash. Used for type switches.
    _     [4]byte
    fun   [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.
}
```

æ ¸å¿ƒå­—æ®µå¦‚ä¸‹ï¼š
* interï¼šå­˜å‚¨ç€è¿™ä¸ªæ¥å£ç±»å‹è‡ªèº«çš„ä¿¡æ¯
* _typeï¼šå­˜å‚¨ç€è¿™ä¸ªæ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹çš„ä¿¡æ¯
* funcï¼šåŠ¨æ€ç±»å‹å·²å®ç°çš„æ¥å£æ–¹æ³•çš„è°ƒç”¨åœ°å€æ•°ç»„

å…¶ä¸­ interfacetype ç»“æ„çš„å®šä¹‰å¦‚ä¸‹ï¼š
```go
// $GOROOT/src/runtime/type.go
type interfacetype struct {
    typ     _type       // interfacetype ç»“æ„ç”±ç±»å‹ä¿¡æ¯
    pkgpath name        // åŒ…è·¯å¾„å
    mhdr    []imethod   // æ¥å£æ–¹æ³•é›†åˆåˆ‡ç‰‡ï¼ˆmhdrï¼‰
}
```

ä¸ºäº†æ›´å¥½åœ°ç†è§£ eface ä¸ iface åœ¨å†…å­˜çš„è¡¨ç¤ºï¼Œä¸‹é¢åˆ†åˆ«

## ç©ºæ¥å£ç±»å‹å†…å­˜ä¸­è¡¨ç¤º

```go
type T struct {
	name string
	age  int
}

func main() {
	var t = T{
		age:  23,
		name: "yumi",
	}

	var ei interface{} = t   // Goè¿è¡Œæ—¶ä½¿ç”¨efaceç»“æ„è¡¨ç¤ºei
 
	println("ei = ", ei)      // ei =  (0x1097d60,0xc00000c030)
	fmt.Println("ei = ", ei)  // ei =  {yumi 23}
	fmt.Printf("%T \n", ei)   // main.T 
}
```

è¯¥ç¤ºä¾‹ä»£ç ä¸­çš„ç©ºæ¥å£ç±»å‹å˜é‡ ei åœ¨å†…å­˜ä¸­çš„è¡¨ç¤º å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.jsdelivr.net/gh/0xAiKang/CDN/blog/images/ç©ºæ¥å£ç±»å‹åœ¨å†…å­˜ä¸­çš„è¡¨ç¤º.jpg)

å¯ä»¥çœ‹åˆ°ç©ºæ¥å£ç±»å‹çš„è¡¨ç¤ºè¾ƒä¸ºç®€å•ï¼š
* _type å­—æ®µæŒ‡å‘å®ƒçš„åŠ¨æ€ç±»å‹ T çš„ç±»å‹ä¿¡æ¯
* data å­—æ®µæŒ‡å‘ä¸€ä¸ª T ç±»å‹çš„å®ä¾‹å€¼

### éç©ºæ¥å£ç±»å‹å†…å­˜ä¸­è¡¨ç¤º

```go
type T struct {
	name string
	age  int
}

func (t T) M1() {}
func (t T) M2() {}

type NonEmptyInterface interface {
	M1()
	M2()
}

func main() {
	var t = T{
		name: "yumi",
		age:  23,
	}

	var i NonEmptyInterface = t
  
	println("i = ", i)        // i =  (0x10c2248,0xc0000a4018)
	fmt.Println("i = ", i)    // i =  {yumi 23}
	fmt.Printf("%T \n", i)    // main.T
}
```

å’Œ eface æ¯”èµ·æ¥ï¼Œiface çš„è¡¨ç¤ºç¨å¾®å¤æ‚äº›ï¼Œä¸‹å›¾æ˜¯ æ¥å£ç±»å‹å˜é‡i åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š

![](https://cdn.jsdelivr.net/gh/0xAiKang/CDN/blog/images/éç©ºæ¥å£ç±»å‹åœ¨å†…å­˜ä¸­çš„è¡¨ç¤º.jpg)

è™½ç„¶ eface å’Œ iface çš„ç¬¬ä¸€ä¸ªå­—æ®µæœ‰æ‰€å·®åˆ«ï¼Œä½† tab å’Œ _type å¯ä»¥ç»Ÿä¸€çœ‹ä½œæ˜¯åŠ¨æ€ç±»å‹ä¿¡æ¯ã€‚Go è¯­è¨€ä¸­æ¯ç§ç±»å‹éƒ½ä¼šæœ‰å”¯ä¸€çš„ _type ä¿¡æ¯ï¼Œæ— è®ºæ˜¯å†…ç½®åŸç”Ÿç±»å‹ï¼Œè¿˜æ˜¯è‡ªå®šä¹‰ç±»å‹éƒ½æœ‰ã€‚Go è¿è¡Œæ—¶ä¼šä¸ºç¨‹åºå†…çš„å…¨éƒ¨ç±»å‹å»ºç«‹åªè¯»çš„å…±äº« _type ä¿¡æ¯è¡¨ï¼Œå› æ­¤**æ‹¥æœ‰ç›¸åŒåŠ¨æ€ç±»å‹çš„åŒç±»æ¥å£ç±»å‹å˜é‡çš„ _type/tab ä¿¡æ¯æ˜¯ç›¸åŒçš„**ã€‚

æ¥å£ç±»å‹å˜é‡çš„ data éƒ¨åˆ†åˆ™æ˜¯æŒ‡å‘ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªå†…å­˜ç©ºé—´å­˜å‚¨çš„æ˜¯èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹å˜é‡çš„å€¼ã€‚\
æœªæ˜¾å¼åˆå§‹åŒ–çš„æ¥å£ç±»å‹å˜é‡çš„å€¼ä¸º nilï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå˜é‡çš„ _type/tab å’Œ data éƒ½ä¸º nilã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ¤æ–­ä¸¤ä¸ªæ¥å£ç±»å‹å˜é‡æ˜¯å¦ç›¸åŒï¼Œ**åªéœ€è¦åˆ¤æ–­ _type/tab æ˜¯å¦ç›¸åŒï¼Œä»¥åŠ data æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´æ‰€å­˜å‚¨çš„æ•°æ®å€¼æ˜¯å¦ç›¸åŒ**å°±å¯ä»¥äº†ã€‚
æ³¨æ„ ğŸš§ï¼Œè¿™é‡Œä¸æ˜¯ data æŒ‡é’ˆçš„å€¼ç›¸åŒã€‚

## æ¯”è¾ƒæ¥å£å˜é‡

### nil æ¥å£å˜é‡
æœªèµ‹åˆå€¼çš„æ¥å£ç±»å‹å˜é‡çš„å€¼ä¸º nilï¼Œè¿™ç±»å˜é‡ä¹Ÿå°±æ˜¯ nil æ¥å£å˜é‡ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹å†…å­˜ä¸­è¡¨ç¤ºè¾“å‡ºçš„ä¾‹å­ï¼š
```go
func printNilInterface() {
	// nilæ¥å£å˜é‡
	var i interface{} // ç©ºæ¥å£ç±»å‹
	var err error     // éç©ºæ¥å£ç±»å‹
	println(i)
	println(err)
	println("i = nil:", i == nil)
	println("err = nil:", err == nil)
	println("i = err:", i == err)
}
```

è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š
```go
(0x0,0x0)
(0x0,0x0)
i = nil: true
err = nil: true
i = err: true
```

å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç©ºæ¥å£ç±»å‹å˜é‡è¿˜æ˜¯éç©ºæ¥å£ç±»å‹å˜é‡ï¼Œä¸€æ—¦å˜é‡å€¼ä¸º nilï¼Œé‚£ä¹ˆå®ƒä»¬å†…éƒ¨è¡¨ç¤ºå‡ä¸º`(0x0,0x0)`ï¼Œä¹Ÿå°±æ˜¯ç±»å‹ä¿¡æ¯ã€æ•°æ®å€¼ä¿¡æ¯å‡ä¸ºç©ºã€‚å› æ­¤ä¸Šé¢çš„å˜é‡ i å’Œ err ç­‰å€¼åˆ¤æ–­ä¸º trueã€‚

### ç©ºæ¥å£ç±»å‹å˜é‡

ä¸‹é¢æ˜¯ç©ºæ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºè¾“å‡ºçš„ä¾‹å­ï¼š
```go
func printEmptyInterface() {
    var eif1 interface{} // ç©ºæ¥å£ç±»å‹
    var eif2 interface{} // ç©ºæ¥å£ç±»å‹
    var n, m int = 17, 18

    eif1 = n
    eif2 = m
    println("eif1:", eif1)
    println("eif2:", eif2)
    println("eif1 = eif2:", eif1 == eif2) // false

    eif2 = 17
    println("eif1:", eif1)
    println("eif2:", eif2)
    println("eif1 = eif2:", eif1 == eif2) // true

    eif2 = int64(17)
    println("eif1:", eif1)
    println("eif2:", eif2)
    println("eif1 = eif2:", eif1 == eif2) // false
}
```

è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š
```go
eif1: (0x10ac580,0xc00007ef48)
eif2: (0x10ac580,0xc00007ef40)
eif1 = eif2: false
eif1: (0x10ac580,0xc00007ef48)
eif2: (0x10ac580,0x10eb3d0)
eif1 = eif2: true
eif1: (0x10ac580,0xc00007ef48)
eif2: (0x10ac640,0x10eb3d8)
eif1 = eif2: false
```

ç¤ºä¾‹ä»£ç çš„é€»è¾‘å¾ˆæ¸…æ™°ï¼š
* ç¬¬ä¸€æ¬¡æ‰“å°ï¼šåŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼ˆéƒ½æ˜¯ intï¼‰ï¼Œæ‰€ä»¥ _type éƒ½æ˜¯0x10ac580ï¼Œä½†æ˜¯ data æŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­å­˜å‚¨çš„å€¼ä¸ä¸€æ ·ï¼Œå› æ­¤ eif1 ä¸ç­‰äº eif2
* ç¬¬äºŒæ¬¡æ‰“å°ï¼šåŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼Œdata æŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­å­˜å‚¨çš„å€¼ä¹Ÿç›¸åŒï¼Œå› æ­¤ eif1 ç­‰äº eif2
* ç¬¬ä¸‰æ¬¡æ‰“å°ï¼šåŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯ä¸åŒï¼ˆä¸€ä¸ªæ˜¯ intï¼Œä¸€ä¸ªæ˜¯ int64ï¼‰ï¼Œå³ä¾¿ data æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ä¸­å­˜å‚¨å€¼æ˜¯ç›¸åŒçš„ï¼Œæœ€ç»ˆ eif1 ä¹Ÿä¸ç­‰äº eif2

ç»“è®ºï¼š**å¯¹äºç©ºæ¥å£ç±»å‹å˜é‡ï¼Œåªæœ‰ _type å’Œ data æ‰€æŒ‡æ•°æ®å†…å®¹ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªç©ºæ¥å£ç±»å‹å˜é‡ä¹‹é—´æ‰èƒ½åˆ’ç­‰å·**ã€‚

### éç©ºæ¥å£ç±»å‹å˜é‡

```go
type T int
func (t T) Error() string { 
    return "bad error"
}
func printNonEmptyInterface() { 
    var err1 error // éç©ºæ¥å£ç±»å‹
    var err2 error // éç©ºæ¥å£ç±»å‹
    err1 = (*T)(nil)
    println("err1:", err1)
    println("err1 = nil:", err1 == nil)
    err1 = T(5)
    err2 = T(6)
    println("err1:", err1)
    println("err2:", err2)
    println("err1 = err2:", err1 == err2)
    err2 = fmt.Errorf("%d\n", 5)
    println("err1:", err1)
    println("err2:", err2)
    println("err1 = err2:", err1 == err2)
}
```

è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š
```go
eif1: (0x10ac580,0xc00007ef48)
eif2: (0x10ac580,0xc00007ef40)
eif1 = eif2: false
eif1: (0x10ac580,0xc00007ef48)
eif2: (0x10ac580,0x10eb3d0)
eif1 = eif2: true
eif1: (0x10ac580,0xc00007ef48)
eif2: (0x10ac640,0x10eb3d8)
eif1 = eif2: false
```

çœ‹åˆ°ä¸Šé¢ç¤ºä¾‹ä¸­æ¯ä¸€è½®é€šè¿‡ println è¾“å‡ºçš„ err1 å’Œ err2 çš„ tab å’Œ data å€¼ï¼Œè¦ä¹ˆ data å€¼ä¸åŒï¼Œè¦ä¹ˆ tab ä¸ data å€¼éƒ½ä¸åŒã€‚

å’Œç©ºæ¥å£ç±»å‹å˜é‡ä¸€æ ·ï¼Œåªæœ‰ tab å’Œ data æŒ‡çš„æ•°æ®å†…å®¹ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªéç©ºæ¥å£ç±»å‹å˜é‡ä¹‹é—´æ‰èƒ½åˆ’ç­‰å·ã€‚

è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ err1 ä¸‹é¢çš„èµ‹å€¼æƒ…å†µï¼š
```
err1 = (*T)(nil)
```

é’ˆå¯¹è¿™ç§èµ‹å€¼ï¼Œprintln è¾“å‡ºçš„ err1 æ˜¯ï¼ˆ0x10ed120, 0x0ï¼‰ï¼Œä¹Ÿå°±æ˜¯éç©ºæ¥å£ç±»å‹å˜é‡çš„ç±»å‹ä¿¡æ¯å¹¶ä¸ä¸ºç©ºï¼Œæ•°æ®æŒ‡é’ˆä¸ºç©ºï¼Œå› æ­¤å®ƒä¸ nilï¼ˆ0x0,0x0ï¼‰ä¹‹é—´ä¸èƒ½åˆ’ç­‰å·ã€‚

ç°åœ¨æˆ‘ä»¬å†å›åˆ°æˆ‘ä»¬å¼€å¤´çš„é‚£ä¸ªé—®é¢˜ï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»è±ç„¶å¼€æœ—äº†å‘¢ï¼Ÿå¼€å¤´çš„é—®é¢˜ä¸­ï¼Œä» returnsError è¿”å›çš„ error æ¥å£ç±»å‹å˜é‡ err çš„æ•°æ®æŒ‡é’ˆè™½ç„¶ä¸ºç©ºï¼Œä½†å®ƒçš„ç±»å‹ä¿¡æ¯ï¼ˆiface.tabï¼‰å¹¶ä¸ä¸ºç©ºï¼Œè€Œæ˜¯ *MyError å¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œè¿™æ · err ä¸ nilï¼ˆ0x0,0x0ï¼‰ç›¸æ¯”è‡ªç„¶ä¸ç›¸ç­‰ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¼€å¤´é‚£ä¸ªé—®é¢˜çš„ç­”æ¡ˆè§£æï¼Œç°åœ¨ä½ æ˜ç™½äº†å—ï¼Ÿ

ç°åœ¨å†å›å¤´çœ‹ä¸Šé¢é‚£ä¸ªé—®é¢˜ï¼Œæ˜¯ä¸æ˜¯æ¸…æ™°å¾ˆå¤šäº†ã€‚\
å› ä¸º returnsError è¿”å›çš„ error æ¥å£ç±»å‹å˜é‡ err çš„æ•°æ®æŒ‡é’ˆè™½ç„¶ä¸ºç©ºï¼Œä½†å®ƒçš„ç±»å‹ä¿¡æ¯ï¼ˆiface.data) å¹¶ä¸ä¸ºç©ºï¼Œè€Œæ˜¯ `*MyError` å¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œå› æ­¤ err ä¸ nil å¹¶ä¸ç›¸ç­‰ã€‚

### ç©ºæ¥å£ç±»å‹å˜é‡ä¸éç©ºæ¥å£ç±»å‹å˜é‡çš„ç­‰å€¼æ¯”è¾ƒ

```go
func printEmptyInterfaceAndNonEmptyInterface() {
  var eif interface{} = T(5)
  var err error = T(5)
  println("eif:", eif)
  println("err:", err)
  println("eif = err:", eif == err)
  err = T(6)
  println("eif:", eif)
  println("err:", err)
  println("eif = err:", eif == err)
}
```

è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š
```go
eif: (0x1093500,0x10c0808)
err: (0x10c0d58,0x10c0808)
eif = err: true
eif: (0x1093500,0x10c0808)
err: (0x10c0d58,0x10c0810)
eif = err: false
```
å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ç©ºæ¥å£ç±»å‹å˜é‡ï¼ˆeface(_type, data)ï¼‰å’Œéç©ºæ¥å£ç±»å‹å˜é‡ï¼ˆiface(tab, data)ï¼‰å†…éƒ¨è¡¨ç¤ºçš„ç»“æ„ä¸ä¸€æ ·ï¼Œä½†Go åœ¨è¿›è¡Œç­‰å€¼æ¯”è¾ƒæ—¶ï¼Œç±»å‹æ¯”è¾ƒç”¨çš„æ˜¯ eface._type å’Œ eface.tab._typeï¼Œå› æ­¤åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œeif å’Œ err éƒ½æ˜¯T(5) æ—¶ï¼Œä¸¤è€…æ˜¯ç›¸ç­‰çš„ã€‚

## æ€»ç»“
* åŠ¨æ€ç‰¹æ€§è®© Go æ‹¥æœ‰ä¸åŠ¨æ€è¯­è¨€ç›¸è¿‘çš„çµæ´»æ€§ï¼Œè€Œé™æ€ç‰¹æ€§åˆåœ¨ç¼–è¯‘é˜¶æ®µä¿è¯äº†è¿™ç§çµæ´»æ€§çš„å®‰å…¨
* åˆ¤æ–­ä¸¤ä¸ªæ¥å£ç±»å‹å˜é‡æ˜¯å¦ç›¸åŒï¼Œä¸ä»…éœ€è¦ _type/tab ç›¸åŒï¼Œè¿˜éœ€è¦ data æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å€¼ç›¸åŒ

## å‚è€ƒé“¾æ¥
* [Tony Bai Â· Go è¯­è¨€ç¬¬ä¸€è¯¾](https://time.geekbang.org/column/intro/100093501)